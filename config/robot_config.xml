<?xml version="1.0" encoding="utf-8"?>
<qr name="quadruped_robot">

  <!-- Prepare resources for user aims to control the robot -->
	<!-- All of the hardwares list here, and it will be automatic instance -->
	<res attr="resources">
		<fl>
			<yaw  auto_inst="middleware::Joint" leg="fl" jnt="yaw"  name="fl_yaw"  />
			<hip  auto_inst="middleware::Joint" leg="fl" jnt="hip"  name="fl_hip"  />
			<knee auto_inst="middleware::Joint" leg="fl" jnt="knee" name="fl_knee" />
			<td   auto_inst="middleware::ForceSensor" leg="fl"                     />
		</fl>

		<hl>
			<yaw  auto_inst="middleware::Joint" leg="hl" jnt="yaw"  name="hl_yaw"  />
			<hip  auto_inst="middleware::Joint" leg="hl" jnt="hip"  name="hl_hip"  />
			<knee auto_inst="middleware::Joint" leg="hl" jnt="knee" name="hl_knee" />
			<td   auto_inst="middleware::ForceSensor" leg="hl"                     />
		</hl>

		<fr>
			<yaw  auto_inst="middleware::Joint" leg="fr" jnt="yaw"  name="fr_yaw"  />
			<hip  auto_inst="middleware::Joint" leg="fr" jnt="hip"  name="fr_hip"  />
			<knee auto_inst="middleware::Joint" leg="fr" jnt="knee" name="fr_knee" />
			<td   auto_inst="middleware::ForceSensor" leg="fr"                     />
		</fr>

		<hr>
			<yaw  auto_inst="middleware::Joint" leg="hr" jnt="yaw"  name="hr_yaw"  />
			<hip  auto_inst="middleware::Joint" leg="hr" jnt="hip"  name="hr_hip"  />
			<knee auto_inst="middleware::Joint" leg="hr" jnt="knee" name="hr_knee" />
			<td   auto_inst="middleware::ForceSensor" leg="hr"                     />
		</hr>
		<imu    auto_inst="middleware::ImuSensor" />
	</res>

	<!-- About propagates, it will be automatic instance and addtion to PropagatesManager -->
	<!-- These objects as follow communication between the real robot directly -->
	<propa attr="propagates" >
		<!--pcan_fake auto_inst="middleware::PcanChannelFake"
			output="/home/bibei/output" repeat="true" input="/home/bibei/input"
			channel="0x51" baud="500" type="0" port="0" interrupt="0" /-->
		<pcan auto_inst="middleware::MotorPcan" bus="0x01"
			channel="0x51" baud="500" type="0"  port="0" interrupt="0" hijack="true" >
			<!-- gains="Kp Ki Kd" limits = "iMin iMax error_threshold" -->
			<pid_0  node_id="0x02" leg="fl" jnt="yaw"  gains="1.20 0.10 0.10" limits="0 200 10" />
			<pid_1  node_id="0x02" leg="fl" jnt="hip"  gains="1.40 0.01 0.10" limits="0 200 10" />
			<pid_2  node_id="0x02" leg="fl" jnt="knee" gains="0.55 0.00 0.00" limits="0 200 10" />
			<pid_3  node_id="0x03" leg="hl" jnt="yaw"  gains="1.20 0.10 0.10" limits="0 200 10" />
			<pid_4  node_id="0x03" leg="hl" jnt="hip"  gains="1.40 0.01 0.10" limits="0 200 10" />
			<pid_5  node_id="0x03" leg="hl" jnt="knee" gains="0.55 0.00 0.00" limits="0 200 10" />
			<pid_6  node_id="0x04" leg="fr" jnt="yaw"  gains="1.20 0.10 0.10" limits="0 200 10" />
			<pid_7  node_id="0x04" leg="fr" jnt="hip"  gains="1.40 0.01 0.10" limits="0 200 10" />
			<pid_8  node_id="0x04" leg="fr" jnt="knee" gains="0.55 0.00 0.00" limits="0 200 10" />
			<pid_9  node_id="0x05" leg="hr" jnt="yaw"  gains="1.20 0.10 0.10" limits="0 200 10" />
			<pid_10 node_id="0x05" leg="hr" jnt="hip"  gains="1.40 0.01 0.10" limits="0 200 10" />
			<pid_11 node_id="0x05" leg="hr" jnt="knee" gains="0.55 0.00 0.00" limits="0 200 10" />
		</pcan>

		<usb auto_inst="middleware::ImuUsb"   bus="0x02"
			channel="/dev/ttyUSB0" baud="9600"  node_id="0x06" />
	</propa>

	<!-- Got the packet message from PropagateManager and update the information of hardware -->
	<!-- All of the nodes will be managed by HwManager which contains propagates-->
	<nodes attr="hardwares">
		<lf>
			<node auto_inst="middleware::LegNode" leg="fl" node_id="0x02" >
				<!-- ABS(scale) = \frac{360 \pi \alpha}{180*4096} = \frac{360\pi}{180*4096} -->
				<!-- offset = - \frac{\pi}{18000}\alpha*\beta = -0.000174528*\beta -->
				<joint_0     jnt="yaw"  label="qr.res.fl.yaw"  scale="1"  offset="16200" />
				<joint_1     jnt="hip"  label="qr.res.fl.hip"  scale="-1" offset="23034" />
				<joint_2     jnt="knee" label="qr.res.fl.knee" scale="1"  offset="25180" />
				<touchdown              label="qr.res.fl.td" />
			</node>
		</lf>

		<hl>
			<node auto_inst="middleware::LegNode" leg="hl" node_id="0x03" >
				<joint_0     jnt="yaw"  label="qr.res.hl.yaw"  scale="-1" offset="19176" />
				<joint_1     jnt="hip"  label="qr.res.hl.hip"  scale="-1" offset="5316" />
				<joint_2     jnt="knee" label="qr.res.hl.knee" scale="1"  offset="3940" />
				<touchdown              label="qr.res.hl.td" />
			</node>
		</hl>

		<fr>
			<node auto_inst="middleware::LegNode" leg="fr" node_id="0x04" >
				<joint_0     jnt="yaw"  label="qr.res.fr.yaw"  scale="1"  offset="18146" />
				<joint_1     jnt="hip"  label="qr.res.fr.hip"  scale="1"  offset="2346"  />
				<joint_2     jnt="knee" label="qr.res.fr.knee" scale="-1" offset="15590"  />
				<touchdown              label="qr.res.fr.td" />
			</node>
		</fr>

		<hr>
			<node auto_inst="middleware::LegNode" leg="hr" node_id="0x05" >
				<joint_0     jnt="yaw"  label="qr.res.hr.yaw"  scale="-1" offset="15824"  />
				<joint_1     jnt="hip"  label="qr.res.hr.hip"  scale="1"  offset="19744" />
				<joint_2     jnt="knee" label="qr.res.hr.knee" scale="-1" offset="28050"   />
				<touchdown              label="qr.res.hr.td" />
			</node>
		</hr>

		<imu_node auto_inst="middleware::ImuNode" node_id="0x06" label="qr.res.imu"  />
		<!-- power_node auto_inst="middleware::Power" node_id="0x08"  /-->
	</nodes>

	<!-- User Layer -->
	<wrapper>
		<!-- The necessary parameters are asked by MiiRobot -->
		<robot>
			<joints     labels="qr.res.fl.yaw qr.res.fl.hip qr.res.fl.knee
												  qr.res.hl.yaw qr.res.hl.hip qr.res.hl.knee
												  qr.res.fr.yaw qr.res.fr.hip qr.res.fr.knee
												  qr.res.hr.yaw qr.res.hr.hip qr.res.hr.knee" />

			<touchdowns labels="qr.res.fl.td qr.res.hl.td
												  qr.res.fr.td qr.res.hr.td" />
			<imu        labels="qr.res.imu" />
		</robot>
		<!-- The necessary parameters are asked by RosWrapper -->
		<roswrapper>
			<touchdown_0 label="qr.res.fl.td" name="fl_td" frame_id="fl_foot" />
			<touchdown_1 label="qr.res.fr.td" name="fr_td" frame_id="fr_foot" />
			<touchdown_2 label="qr.res.hl.td" name="hl_td" frame_id="hl_foot" />
			<touchdown_3 label="qr.res.hr.td" name="hr_td" frame_id="hr_foot" />
			<imu         label="qr.res.imu"   name="imu"   frame_id="body" />
		</roswrapper>
	</wrapper>

</qr>
